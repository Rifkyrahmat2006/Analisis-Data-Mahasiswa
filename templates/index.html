<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Analysis Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
    <style>
        .chart-container {
            position: relative;
            margin: auto;
            height: 300px;
            width: 100%;
        }
        .stats-card {
            margin-bottom: 20px;
        }
        .nav-tabs {
            margin-bottom: 20px;
        }
        .metric-card {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container-fluid mt-4">
        <h1 class="text-center mb-4">Data Analisis Mahasiswa</h1>
        
        <ul class="nav nav-tabs" id="metricTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="ipk-tab" data-bs-toggle="tab" data-bs-target="#ipk" type="button" role="tab">IPK    </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="ips-rata-tab" data-bs-toggle="tab" data-bs-target="#ips-rata" type="button" role="tab">IPS Rata-rata</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="ips-akhir-tab" data-bs-toggle="tab" data-bs-target="#ips-akhir" type="button" role="tab">IPS Semester Akhir</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="mk-tidak-lulus-tab" data-bs-toggle="tab" data-bs-target="#mk-tidak-lulus" type="button" role="tab">Mata Kuliah Tidak Lulus</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="cuti-tab" data-bs-toggle="tab" data-bs-target="#cuti" type="button" role="tab">Cuti Akademik</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="semester-tab" data-bs-toggle="tab" data-bs-target="#semester" type="button" role="tab">Jumlah Semester</button>
            </li>
        </ul>

        <div class="tab-content" id="metricTabsContent">
            <!-- IPK Tab -->
            <div class="tab-pane fade show active" id="ipk" role="tabpanel">
                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title">Data IPK</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <input type="text" class="form-control" id="ipkSearchInput" placeholder="Cari nama atau nilai..." onkeyup="handleSearch('ipkSearchInput', 'IPK')">
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>No</th>
                                                <th>Nama Lengkap</th>
                                                <th>IPK</th>
                                                <th>Status Kelulusan</th>
                                            </tr>
                                        </thead>
                                        <tbody id="ipkTableBody">
                                            <!-- Data will be populated here -->
                                        </tbody>
                                    </table>
                                </div>
                                <nav aria-label="Page navigation">
                                    <ul class="pagination justify-content-center" id="ipkPagination">
                                        <!-- Pagination will be added here -->
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title">Statistik IPK</h5>
                            </div>
                            <div class="card-body">
                                <div id="ipkStats">
                                    <!-- Statistics will be populated here -->
                                </div>
                                <div class="chart-container">
                                    <canvas id="ipkChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- IPS Rata-rata Tab -->
            <div class="tab-pane fade" id="ips-rata" role="tabpanel">
                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title">Data IPS Rata-rata</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <input type="text" class="form-control" id="ipsRataSearchInput" placeholder="Cari nama atau nilai..." onkeyup="handleSearch('ipsRataSearchInput', 'IPS_Rata_rata')">
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>No</th>
                                                <th>Nama Lengkap</th>
                                                <th>IPS Rata-rata   </th>
                                                <th>Status Kelulusan</th>
                                            </tr>
                                        </thead>
                                        <tbody id="ipsRataTableBody">
                                            <!-- Data will be populated here -->
                                        </tbody>
                                    </table>
                                </div>
                                <nav aria-label="Page navigation">
                                    <ul class="pagination justify-content-center" id="ipsRataPagination">
                                        <!-- Pagination will be added here -->
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title">Statistik IPS Rata-rata</h5>
                            </div>
                            <div class="card-body">
                                <div id="ipsRataStats">
                                    <!-- Statistics will be populated here -->
                                </div>
                                <div class="chart-container">
                                    <canvas id="ipsRataChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- IPS Semester Akhir Tab -->
            <div class="tab-pane fade" id="ips-akhir" role="tabpanel">
                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title">Data IPS Semester Akhir</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <input type="text" class="form-control" id="ipsAkhirSearchInput" placeholder="Cari nama atau nilai..." onkeyup="handleSearch('ipsAkhirSearchInput', 'IPS_Semester_Akhir')">
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>No</th>
                                                <th>Nama Lengkap</th>
                                                <th>IPS Semester Akhir</th>
                                                <th>Status Kelulusan</th>
                                            </tr>
                                        </thead>
                                        <tbody id="ipsAkhirTableBody">
                                            <!-- Data will be populated here -->
                                        </tbody>
                                    </table>
                                </div>
                                <nav aria-label="Page navigation">
                                    <ul class="pagination justify-content-center" id="ipsAkhirPagination">
                                        <!-- Pagination will be added here -->
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title">Statistik IPS Semester Akhir</h5>
                            </div>
                            <div class="card-body">
                                <div id="ipsAkhirStats">
                                    <!-- Statistics will be populated here -->
                                </div>
                                <div class="chart-container">
                                    <canvas id="ipsAkhirChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mata Kuliah Tidak Lulus Tab -->
            <div class="tab-pane fade" id="mk-tidak-lulus" role="tabpanel">
                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title">Data Mata Kuliah Tidak Lulus</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <input type="text" class="form-control" id="mkSearchInput" placeholder="Cari nama atau nilai..." onkeyup="handleSearch('mkSearchInput', 'Mata_Kuliah_Tidak_Lulus')">
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>No</th>
                                                <th>Nama Lengkap</th>
                                                <th>Jumlah MK Tidak Lulus</th>
                                                <th>Status Kelulusan</th>
                                            </tr>
                                        </thead>
                                        <tbody id="mkTableBody">
                                            <!-- Data will be populated here -->
                                        </tbody>
                                    </table>
                                </div>
                                <nav aria-label="Page navigation">
                                    <ul class="pagination justify-content-center" id="mkPagination">
                                        <!-- Pagination will be added here -->
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title">Statistik Mata Kuliah Tidak Lulus</h5>
                            </div>
                            <div class="card-body">
                                <div id="mkStats">
                                    <!-- Statistics will be populated here -->
                                </div>
                                <div class="chart-container">
                                    <canvas id="mkChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cuti Akademik Tab -->
            <div class="tab-pane fade" id="cuti" role="tabpanel">
                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title">Data Cuti Akademik</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <input type="text" class="form-control" id="cutiSearchInput" placeholder="Cari nama atau nilai..." onkeyup="handleSearch('cutiSearchInput', 'Jumlah_Cuti_Akademik')">
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>No</th>
                                                <th>Nama Lengkap</th>
                                                <th>Jumlah Cuti</th>
                                                <th>Status Kelulusan</th>
                                            </tr>
                                        </thead>
                                        <tbody id="cutiTableBody">
                                            <!-- Data will be populated here -->
                                        </tbody>
                                    </table>
                                </div>
                                <nav aria-label="Page navigation">
                                    <ul class="pagination justify-content-center" id="cutiPagination">
                                        <!-- Pagination will be added here -->
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title">Statistik Cuti Akademik</h5>
                            </div>
                            <div class="card-body">
                                <div id="cutiStats">
                                    <!-- Statistics will be populated here -->
                                </div>
                                <div class="chart-container">
                                    <canvas id="cutiChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Jumlah Semester Tab -->
            <div class="tab-pane fade" id="semester" role="tabpanel">
                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title">Data Jumlah Semester</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <input type="text" class="form-control" id="semesterSearchInput" placeholder="Cari nama atau nilai..." onkeyup="handleSearch('semesterSearchInput', 'Jumlah_Semester')">
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>No</th>
                                                <th>Nama Lengkap</th>
                                                <th>Jumlah Semester</th>
                                                <th>Status Kelulusan</th>
                                            </tr>
                                        </thead>
                                        <tbody id="semesterTableBody">
                                            <!-- Data will be populated here -->
                                        </tbody>
                                    </table>
                                </div>
                                <nav aria-label="Page navigation">
                                    <ul class="pagination justify-content-center" id="semesterPagination">
                                        <!-- Pagination will be added here -->
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title">Statistik Jumlah Semester</h5>
                            </div>
                            <div class="card-body">
                                <div id="semesterStats">
                                    <!-- Statistics will be populated here -->
                                </div>
                                <div class="chart-container">
                                    <canvas id="semesterChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="{{ url_for('static', filename='js/chart-boxplot.js') }}"></script>
    <script>
        let currentPage = 1;
        let totalPages = 1;
        let allData = [];
        let stats = {};
        let charts = {}; // Store chart instances
        // Variabel untuk menyimpan nilai pencarian saat ini
        let currentSearches = {
            'IPK': '',
            'IPS_Rata_rata': '',
            'IPS_Semester_Akhir': '',
            'Mata_Kuliah_Tidak_Lulus': '',
            'Jumlah_Cuti_Akademik': '',
            'Jumlah_Semester': ''
        };

        // Fungsi untuk memuat semua data dan statistik (termasuk grafik)
        async function loadAllData() {
            try {
                // Muat statistik terlebih dahulu
                const statsResponse = await fetch('/api/stats');
                stats = await statsResponse.json();
                
                // Load data untuk setiap tab
                await loadIPKData(1, 10);
                await loadIPSRataData(1, 10);
                await loadIPSAkhirData(1, 10);
                await loadMKData(1, 10);
                await loadCutiData(1, 10);
                await loadSemesterData(1, 10);
                
                // Update semua grafik
                updateAllCharts();
            } catch (error) {

            }
        }
        
        // Fungsi untuk memuat data halaman tertentu (hanya update tabel)
        async function loadPageData(page = 1) {
            try {
                const dataResponse = await fetch(`/api/data?page=${page}`);
                
                if (!dataResponse.ok) {
                    throw new Error('Network response was not ok');
                }
                
                const dataResult = await dataResponse.json();
                
                currentPage = dataResult.current_page;
                totalPages = dataResult.total_pages;
                allData = dataResult.data;
                
                // Update hanya tabel dan pagination
                updateAllTables();
            } catch (error) {
                console.error('Error loading page data:', error);
            }
        }

        // Fungsi untuk memuat data IPK
        async function loadIPKData(page, perPage, searchQuery = '') {
            try {
                const url = `/api/data?page=${page}&per_page=${perPage}${searchQuery ? `&search=${searchQuery}` : ''}`;
                const response = await fetch(url);
                const data = await response.json();
                
                // Update tabel IPK
                updateTable('ipkTableBody', data.data, 'IPK');
                
                // Update pagination
                updatePagination('ipkPagination', data.current_page, data.total_pages, 'loadIPKPage');
                
                return data;
            } catch (error) {

                return null;
            }
        }

        // Fungsi untuk memuat halaman IPK
        function loadIPKPage(page) {
            currentIPKPage = page;
            loadIPKData(page, 10, currentSearches['IPK']);
        }

        // Fungsi untuk memuat data IPS Rata-rata
        async function loadIPSRataData(page, perPage, searchQuery = '') {
            try {
                const url = `/api/data?page=${page}&per_page=${perPage}${searchQuery ? `&search=${searchQuery}` : ''}`;
                const response = await fetch(url);
                const data = await response.json();
                
                // Update tabel IPS Rata-rata
                updateTable('ipsRataTableBody', data.data, 'IPS_Rata_rata');
                
                // Update pagination
                updatePagination('ipsRataPagination', data.current_page, data.total_pages, 'loadIPSRataPage');
                
                return data;
            } catch (error) {

                return null;
            }
        }

        // Fungsi untuk memuat halaman IPS Rata-rata
        function loadIPSRataPage(page) {
            currentIPSRataPage = page;
            loadIPSRataData(page, 10, currentSearches['IPS_Rata_rata']);
        }

        // Fungsi untuk memuat data IPS Semester Akhir
        async function loadIPSAkhirData(page, perPage, searchQuery = '') {
            try {
                const url = `/api/data?page=${page}&per_page=${perPage}${searchQuery ? `&search=${searchQuery}` : ''}`;
                const response = await fetch(url);
                const data = await response.json();
                
                // Update tabel IPS Semester Akhir
                updateTable('ipsAkhirTableBody', data.data, 'IPS_Semester_Akhir');
                
                // Update pagination
                updatePagination('ipsAkhirPagination', data.current_page, data.total_pages, 'loadIPSAkhirPage');
                
                return data;
            } catch (error) {

                return null;
            }
        }

        // Fungsi untuk memuat halaman IPS Semester Akhir
        function loadIPSAkhirPage(page) {
            currentIPSAkhirPage = page;
            loadIPSAkhirData(page, 10, currentSearches['IPS_Semester_Akhir']);
        }
        
        // Fungsi untuk memuat data Mata Kuliah Tidak Lulus
        async function loadMKData(page, perPage, searchQuery = '') {
            try {
                const url = `/api/data?page=${page}&per_page=${perPage}${searchQuery ? `&search=${searchQuery}` : ''}`;
                const response = await fetch(url);
                const data = await response.json();
                
                // Update tabel Mata Kuliah Tidak Lulus
                updateTable('mkTableBody', data.data, 'Mata_Kuliah_Tidak_Lulus');
                
                // Update pagination
                updatePagination('mkPagination', data.current_page, data.total_pages, 'loadMKPage');
                
                return data;
            } catch (error) {

                return null;
            }
        }

        // Fungsi untuk memuat halaman Mata Kuliah Tidak Lulus
        function loadMKPage(page) {
            currentMKPage = page;
            loadMKData(page, 10, currentSearches['Mata_Kuliah_Tidak_Lulus']);
        }
        
        // Fungsi untuk memuat data Cuti Akademik
        async function loadCutiData(page, perPage, searchQuery = '') {
            try {
                const url = `/api/data?page=${page}&per_page=${perPage}${searchQuery ? `&search=${searchQuery}` : ''}`;
                const response = await fetch(url);
                const data = await response.json();
                
                // Update tabel Cuti Akademik
                updateTable('cutiTableBody', data.data, 'Jumlah_Cuti_Akademik');
                
                // Update pagination
                updatePagination('cutiPagination', data.current_page, data.total_pages, 'loadCutiPage');
                
                return data;
            } catch (error) {

                return null;
            }
        }

        // Fungsi untuk memuat halaman Cuti Akademik
        function loadCutiPage(page) {
            currentCutiPage = page;
            loadCutiData(page, 10, currentSearches['Jumlah_Cuti_Akademik']);
        }

        // Fungsi untuk memuat data Jumlah Semester
        async function loadSemesterData(page, perPage, searchQuery = '') {
            try {
                const url = `/api/data?page=${page}&per_page=${perPage}${searchQuery ? `&search=${searchQuery}` : ''}`;
                const response = await fetch(url);
                const data = await response.json();
                
                // Update tabel Jumlah Semester
                updateTable('semesterTableBody', data.data, 'Jumlah_Semester');
                
                // Update pagination
                updatePagination('semesterPagination', data.current_page, data.total_pages, 'loadSemesterPage');
                
                return data;
            } catch (error) {

                return null;
            }
        }

        // Fungsi untuk memuat halaman Jumlah Semester
        function loadSemesterPage(page) {
            currentSemesterPage = page;
            loadSemesterData(page, 10, currentSearches['Jumlah_Semester']);
        }

        // Fungsi untuk mengupdate semua tabel
        function updateAllTables() {
            try {
                // IPK
                updateTable('ipkTableBody', allData, 'IPK');
                updatePagination('ipkPagination', currentPage, totalPages);
                
                // IPS Rata-rata
                updateTable('ipsRataTableBody', allData, 'IPS_Rata_rata');
                updatePagination('ipsRataPagination', currentPage, totalPages);
                
                // IPS Semester Akhir
                updateTable('ipsAkhirTableBody', allData, 'IPS_Semester_Akhir');
                updatePagination('ipsAkhirPagination', currentPage, totalPages);
                
                // Mata Kuliah Tidak Lulus
                updateTable('mkTableBody', allData, 'Mata_Kuliah_Tidak_Lulus');
                updatePagination('mkPagination', currentPage, totalPages);
                
                // Cuti Akademik
                updateTable('cutiTableBody', allData, 'Jumlah_Cuti_Akademik');
                updatePagination('cutiPagination', currentPage, totalPages);
                
                // Jumlah Semester
                updateTable('semesterTableBody', allData, 'Jumlah_Semester');
                updatePagination('semesterPagination', currentPage, totalPages);
            } catch (error) {

            }
        }
        
        // Fungsi untuk mengupdate semua grafik dan statistik
        function updateAllCharts() {
            try {
                // Update IPK
                updateStats('ipkStats', 'IPK');
                updateChart('ipkChart', stats.IPK, 'IPK');
                
                // Update IPS Rata-rata
                updateStats('ipsRataStats', 'IPS_Rata_rata');
                updateChart('ipsRataChart', stats.IPS_Rata_rata, 'IPS Rata-rata');
                
                // Update IPS Semester Akhir
                updateStats('ipsAkhirStats', 'IPS_Semester_Akhir');
                updateChart('ipsAkhirChart', stats.IPS_Semester_Akhir, 'IPS Semester Akhir');
                
                // Update Mata Kuliah Tidak Lulus
                updateStats('mkStats', 'Mata_Kuliah_Tidak_Lulus');
                updateChart('mkChart', stats.Mata_Kuliah_Tidak_Lulus, 'Mata Kuliah Tidak Lulus');
                
                // Update Cuti Akademik
                updateStats('cutiStats', 'Jumlah_Cuti_Akademik');
                updateChart('cutiChart', stats.Jumlah_Cuti_Akademik, 'Jumlah Cuti Akademik');
                
                // Update Jumlah Semester
                updateStats('semesterStats', 'Jumlah_Semester');
                updateChart('semesterChart', stats.Jumlah_Semester, 'Jumlah Semester');
            } catch (error) {

            }
        }

        // Fungsi untuk mengupdate tabel
        function updateTable(tableId, data, field) {
            const tableBody = document.getElementById(tableId);
            tableBody.innerHTML = '';
            
            data.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${item['Nama Lengkap']}</td>
                    <td>${item[field]}</td>
                    <td>${item['Status_Kelulusan'] === 1 ? 'Lulus' : 'Tidak Lulus'}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Fungsi untuk mengupdate statistik
        function updateStats(statsId, field) {
            const statsDiv = document.getElementById(statsId);
            const fieldStats = stats[field];
            
            statsDiv.innerHTML = `
                <table class="table">
                    <tr>
                        <td>Mean (Rata-rata)</td>
                        <td>${fieldStats.mean.toFixed(2)}</td>
                    </tr>
                    <tr>
                        <td>Median</td>
                        <td>${fieldStats.median.toFixed(2)}</td>
                    </tr>
                    <tr>
                        <td>Modus</td>
                        <td>${fieldStats.mode.join(', ')}</td>
                    </tr>
                    <tr>
                        <td>Range</td>
                        <td>${fieldStats.range.toFixed(2)}</td>
                    </tr>
                    <tr>
                        <td>Varians</td>
                        <td>${fieldStats.variance.toFixed(2)}</td>
                    </tr>
                    <tr>
                        <td>Standar Deviasi</td>
                        <td>${fieldStats.std_dev.toFixed(2)}</td>
                    </tr>
                    <tr>
                        <td>Q1 (Kuartil 1)</td>
                        <td>${fieldStats.quartiles.q1.toFixed(2)}</td>
                    </tr>
                    <tr>
                        <td>Q2 (Median)</td>
                        <td>${fieldStats.quartiles.q2.toFixed(2)}</td>
                    </tr>
                    <tr>
                        <td>Q3 (Kuartil 3)</td>
                        <td>${fieldStats.quartiles.q3.toFixed(2)}</td>
                    </tr>
                </table>
            `;
        }

        // Fungsi untuk mengupdate statistik IPK
        async function updateIPKStats() {
            try {
                const statsResponse = await fetch('/api/stats');
                stats = await statsResponse.json();
                
                updateStats('ipkStats', 'IPK');
                updateChart('ipkChart', stats.IPK, 'IPK');
                return stats;
            } catch (error) {

                return null;
            }
        }
        
        // Fungsi untuk mengupdate statistik IPS Rata-rata
        async function updateIPSRataStats() {
            try {
                const statsResponse = await fetch('/api/stats');
                stats = await statsResponse.json();
                
                updateStats('ipsRataStats', 'IPS_Rata_rata');
                updateChart('ipsRataChart', stats.IPS_Rata_rata, 'IPS Rata-rata');
                return stats;
            } catch (error) {

                return null;
            }
        }
        
        // Fungsi untuk mengupdate statistik IPS Semester Akhir
        async function updateIPSAkhirStats() {
            try {
                const statsResponse = await fetch('/api/stats');
                stats = await statsResponse.json();
                
                updateStats('ipsAkhirStats', 'IPS_Semester_Akhir');
                updateChart('ipsAkhirChart', stats.IPS_Semester_Akhir, 'IPS Semester Akhir');
                return stats;
            } catch (error) {

                return null;
            }
        }
        
        // Fungsi untuk mengupdate statistik Mata Kuliah Tidak Lulus
        async function updateMKStats() {
            try {
                const statsResponse = await fetch('/api/stats');
                stats = await statsResponse.json();
                
                updateStats('mkStats', 'Mata_Kuliah_Tidak_Lulus');
                updateChart('mkChart', stats.Mata_Kuliah_Tidak_Lulus, 'Mata Kuliah Tidak Lulus');
                return stats;
            } catch (error) {

                return null;
            }
        }
        
        // Fungsi untuk mengupdate statistik Cuti Akademik
        async function updateCutiStats() {
            try {
                const statsResponse = await fetch('/api/stats');
                stats = await statsResponse.json();
                
                updateStats('cutiStats', 'Jumlah_Cuti_Akademik');
                updateChart('cutiChart', stats.Jumlah_Cuti_Akademik, 'Jumlah Cuti Akademik');
                return stats;
            } catch (error) {

                return null;
            }
        }
        
        // Fungsi untuk mengupdate statistik Jumlah Semester
        async function updateSemesterStats() {
            try {
                const statsResponse = await fetch('/api/stats');
                stats = await statsResponse.json();
                
                updateStats('semesterStats', 'Jumlah_Semester');
                updateChart('semesterChart', stats.Jumlah_Semester, 'Jumlah Semester');
                return stats;
            } catch (error) {

                return null;
            }
        }
        
        // Fungsi untuk mengupdate chart
        function updateChart(chartId, statsData, fieldLabel) {
            try {
                const ctx = document.getElementById(chartId);
                
                // Destroy existing chart if it exists
                if (charts[chartId]) {
                    charts[chartId].destroy();
                }
                
                // Mendapatkan nilai statistik dari data API
                const mean = statsData.mean;
                const median = statsData.median;
                const range = statsData.range;
                const variance = statsData.variance;
                const stdDev = statsData.std_dev;
                const q1 = statsData.quartiles.q1;
                const q2 = statsData.quartiles.q2;
                const q3 = statsData.quartiles.q3;
                
                // Menghitung nilai maksimum dari nilai minimum dan range
                const min = Math.min(...statsData.all_values);
                const max = min + range;
                
                // Membuat chart baru dengan nilai-nilai statistik
                charts[chartId] = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Mean', 'Median', 'Range', 'Varians', 'Std Dev', 'Q1', 'Q2', 'Q3', 'Min', 'Max'],
                        datasets: [{
                            label: fieldLabel,
                            data: [mean, median, range, variance, stdDev, q1, q2, q3, min, max],
                            backgroundColor: [
                                'rgba(255, 99, 132, 0.7)',  // Mean
                                'rgba(54, 162, 235, 0.7)',  // Median
                                'rgba(255, 206, 86, 0.7)',  // Range
                                'rgba(75, 192, 192, 0.7)',  // Varians
                                'rgba(153, 102, 255, 0.7)', // Std Dev
                                'rgba(255, 159, 64, 0.7)',  // Q1
                                'rgba(54, 162, 235, 0.7)',  // Q2
                                'rgba(255, 99, 132, 0.7)',  // Q3
                                'rgba(50, 205, 50, 0.7)',   // Min
                                'rgba(255, 0, 0, 0.7)'      // Max
                            ],
                            borderColor: [
                                'rgba(255, 99, 132, 1)',
                                'rgba(54, 162, 235, 1)',
                                'rgba(255, 206, 86, 1)',
                                'rgba(75, 192, 192, 1)',
                                'rgba(153, 102, 255, 1)',
                                'rgba(255, 159, 64, 1)',
                                'rgba(54, 162, 235, 1)',
                                'rgba(255, 99, 132, 1)',
                                'rgba(50, 205, 50, 1)',
                                'rgba(255, 0, 0, 1)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            title: {
                                display: true,
                                text: 'Statistik ' + fieldLabel
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const label = context.dataset.label || '';
                                        const value = context.raw;
                                        const statName = context.label;
                                        
                                        if (statName === 'Mean') {
                                            return `${label} Mean: ${value.toFixed(2)}`;
                                        } else if (statName === 'Median') {
                                            return `${label} Median: ${value.toFixed(2)}`;
                                        } else if (statName === 'Range') {
                                            return `${label} Range: ${value.toFixed(2)}`;
                                        } else if (statName === 'Varians') {
                                            return `${label} Varians: ${value.toFixed(2)}`;
                                        } else if (statName === 'Std Dev') {
                                            return `${label} Std Dev: ${value.toFixed(2)}`;
                                        } else if (statName === 'Q1') {
                                            return `${label} Q1: ${value.toFixed(2)}`;
                                        } else if (statName === 'Q2') {
                                            return `${label} Q2: ${value.toFixed(2)}`;
                                        } else if (statName === 'Q3') {
                                            return `${label} Q3: ${value.toFixed(2)}`;
                                        } else if (statName === 'Min') {
                                            return `${label} Min: ${value.toFixed(2)}`;
                                        } else if (statName === 'Max') {
                                            return `${label} Max: ${value.toFixed(2)}`;
                                        }
                                        return `${label}: ${value}`;
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: false,
                                title: {
                                    display: true,
                                    text: 'Nilai'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Statistik'
                                }
                            }
                        }
                    }
                });
                
                // Tidak perlu menampilkan modus lagi
                
            } catch (error) {
            }
        }

        // Fungsi untuk mengupdate pagination
        function updatePagination(paginationId, currentPage, totalPages) {
            const pagination = document.getElementById(paginationId);
            pagination.innerHTML = '';
            
            // Previous button
            const prevLi = document.createElement('li');
            prevLi.className = `page-item ${currentPage === 1 ? 'disabled' : ''}`;
            prevLi.innerHTML = `
                <a class="page-link" href="#" aria-label="Previous" onclick="loadPageData(${currentPage - 1}); return false;">
                    <span aria-hidden="true">&laquo;</span>
                </a>
            `;
            pagination.appendChild(prevLi);
            
            // Page numbers
            for (let i = 1; i <= totalPages; i++) {
                const li = document.createElement('li');
                li.className = `page-item ${i === currentPage ? 'active' : ''}`;
                li.innerHTML = `<a class="page-link" href="#" onclick="loadPageData(${i}); return false;">${i}</a>`;
                pagination.appendChild(li);
            }
            
            // Next button
            const nextLi = document.createElement('li');
            nextLi.className = `page-item ${currentPage === totalPages ? 'disabled' : ''}`;
            nextLi.innerHTML = `
                <a class="page-link" href="#" aria-label="Next" onclick="loadPageData(${currentPage + 1}); return false;">
                    <span aria-hidden="true">&raquo;</span>
                </a>
            `;
            pagination.appendChild(nextLi);
        }


        
        // Fungsi untuk menangani pencarian
        function handleSearch(inputId, dataType) {
            const input = document.getElementById(inputId);
            const searchValue = input.value.trim();
            
            // Simpan nilai pencarian saat ini
            currentSearches[dataType] = searchValue;
            
            // Reset ke halaman pertama dan muat ulang data dengan filter pencarian
            if (dataType === 'IPK') {
                currentIPKPage = 1;
                loadIPKData(currentIPKPage, 10, searchValue);
            } else if (dataType === 'IPS_Rata_rata') {
                currentIPSRataPage = 1;
                loadIPSRataData(currentIPSRataPage, 10, searchValue);
            } else if (dataType === 'IPS_Semester_Akhir') {
                currentIPSAkhirPage = 1;
                loadIPSAkhirData(currentIPSAkhirPage, 10, searchValue);
            } else if (dataType === 'Mata_Kuliah_Tidak_Lulus') {
                currentMKPage = 1;
                loadMKData(currentMKPage, 10, searchValue);
            } else if (dataType === 'Jumlah_Cuti_Akademik') {
                currentCutiPage = 1;
                loadCutiData(currentCutiPage, 10, searchValue);
            } else if (dataType === 'Jumlah_Semester') {
                currentSemesterPage = 1;
                loadSemesterData(currentSemesterPage, 10, searchValue);
            }
        }
        
        // Load data saat halaman dimuat
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                await loadAllData();
            } catch (error) {
                console.error('Error initializing page:', error);
            }
        });
    </script>
</body>
</html> 